package usecase

import (
	"github.com/m-mizutani/octovy/pkg/domain/model"
)

func (x *Default) FindVulnerability(vulnID string) (*model.Vulnerability, error) {
	return x.svc.DB().FindVulnerability(vulnID)
}

func (x *Default) UpdateVulnStatus(status *model.VulnStatus) error {
	now := x.svc.Infra.Utils.TimeNow().Unix()
	status.CreatedAt = now

	if err := status.IsValid(); err != nil {
		return err
	}

	if err := status.Status.IsUpdatable(); err != nil {
		return err
	}

	if err := x.svc.DB().PutVulnStatus(status); err != nil {
		return err
	}

	return nil
}
